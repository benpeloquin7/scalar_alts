---
title: "Untitled"
author: "Ben Peloquin"
date: "June 29, 2016"
output: html_document
---

```{r envir, echo=FALSE}
rm(list=ls())
setwd("~/Desktop/Projects/scalar_alts/")
```


```{r load_packages, echo=FALSE, message=FALSE}
library(stringr)
library(rjson)
library(ggplot2)
library(dplyr)
library(tidyr)
```

```{r helpers}
## Add domain here
DOMAIN <- "restaurant"

alternatives_store <-
  data.frame("bad"="bad_terrible",
             "terrible"="bad_terrible",
             "disliked"="disliked_hated",
             "hated"="disliked_hated",
             "good"="good_excellent",
             "excellent"="good_excellent",
             "liked"="liked_loved",
             "loved"="liked_loved",
             "memorable"="memorable_unforgettable",
             "unforgettable"="memorable_unforgettable",
             "special"="special_unique",
             "unique"="special_unique",
             "low"="low_high",
             "high"="low_high")
```

```{r load_data}
file <- paste0("analysis/corrected_data/", DOMAIN, "_corrected.json")
d <- as.data.frame(fromJSON(file=file))
```

```{r prelim_process}
d2 <- d %>%
  gather(scalar, response) %>%
  rowwise %>%
  mutate(scalar_pair=alternatives_store[[scalar]]) %>%
  group_by(scalar_pair, response) %>%
  summarise(count = n()) %>%
  mutate(domain=DOMAIN) %>%
  arrange(scalar_pair, -count)
names(d2)[3] <- "cnt"

ggplot(d2, aes(x=reorder(response, response), y=cnt)) +
  geom_bar(position="dodge", stat="identity") +
  facet_wrap(~scalar_pair, scales="free") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
d3 <- d2 %>%
  rowwise %>%
  mutate(scalar_pair=alternatives_store[[scalar]]) %>%
  group_by(scalar_pair, response) %>%
  summarise(count=n()) %>%
  arrange(-count)

d3 %>%
  arrange(scalar_pair, -cnt) %>% View

ggplot(d3, aes(x=reorder(response, response), y=cnt)) +
  geom_bar(position="dodge", stat="identity") +
  facet_wrap(~scalar_pair, scales="free") +
   theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


# Aggregate data and write to .csv
```{r}
d_wide <- d2 %>%
  spread(scalar_pair, cnt) %>%
  dplyr::select(-domain)

d_wide[is.na(d_wide)] <- 0

write.csv(d_wide, "analysis/restaurant_td_matrix.csv", row.names=FALSE)
```


